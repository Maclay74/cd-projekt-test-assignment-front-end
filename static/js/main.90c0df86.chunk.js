(this["webpackJsonpcd-project-front-end"]=this["webpackJsonpcd-project-front-end"]||[]).push([[0],{188:function(e,t,a){e.exports={container:"style_container__190RK",error:"style_error__2FU9Y"}},189:function(e,t,a){e.exports={container:"style_container__1QvH7",header:"style_header__2KMRp",title:"style_title__6c_9B"}},190:function(e,t,a){e.exports={container:"style_container__1AQfj",logo:"style_logo__3hw2Z",menu:"style_menu__1IXom"}},307:function(e,t,a){e.exports={container:"style_container__32343"}},311:function(e,t,a){e.exports={container:"style_container__2e7xG"}},317:function(e,t,a){e.exports=a.p+"static/media/twitter-logo.b4d7c717.svg"},318:function(e,t,a){e.exports={layoutContent:"main_layoutContent__1_IWw"}},325:function(e,t,a){e.exports=a(597)},597:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(4),i=a.n(o),c=a(41),s=a(97),u=a(293),l=a(294),p=a(19),h=a.n(p),d=a(31),m=a(86),f="USER/SIGN_IN",g="USER/SIGN_OUT",b={token:null,isAuthorized:!1},v={signIn:function(e){return function(){var t=Object(d.a)(h.a.mark((function t(a){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:localStorage.setItem("token",e),a({type:f,token:e});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},signOut:function(){return function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=3;break;case 3:localStorage.removeItem("token"),t({type:g});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},w=Object(s.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return Object(m.a)({},e,{token:t.payload,isAuthorized:!0});case g:return Object(m.a)({},e,{token:null,isAuthorized:!1});default:return e}}}),y=Object(s.createStore)(w,{},Object(u.composeWithDevTools)(Object(s.applyMiddleware)(l.a))),O=(a(236),a(143)),E=a(66),k=a(109),j=a(87),S=a(110),_=a(111),x=a(127),T=a(112),C=a(51),z=a(128),I=a(191),P=a(298),A=a.n(P),N="https://mishakozlov74.fvds.ru/api",U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",n=y.getState().user.isAuthorized?y.getState().user.token:null;return A()({url:e,method:a,params:"get"===a?t:null,data:"post"===a?t:null,baseURL:N,headers:n?{Authorization:"Bearer ".concat(n)}:{}})},L=function(e){function t(e){var a;return Object(S.a)(this,t),(a=Object(x.a)(this,Object(T.a)(t).call(this,e))).initialValues={login:"",password:""},a.state={error:null},a.validationSchema=I.a().shape({login:I.b("Must be string").required("Login is required"),password:I.b("Must be string").required("Password is required")}),a.onSubmit=a.onSubmit.bind(Object(C.a)(a)),a}return Object(z.a)(t,e),Object(_.a)(t,[{key:"onSubmit",value:function(){var e=Object(d.a)(h.a.mark((function e(t,a){var n,r=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.props.signIn,this.setState({error:null}),e.next=5;break;case 5:U("/auth/log-in",t,"post").then((function(e){return n(e.data.token)})).catch((function(e){if(e.response){var t=e.response.data;for(var n in t.errors){var o=Object(E.a)(t.errors[n],1)[0];a.setFieldError(n,o)}}else r.setState({error:"Unable to connect to the server"})}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.props.children({initialValues:this.initialValues,validationSchema:this.validationSchema,onSubmit:this.onSubmit,error:this.state.error})}}]),t}(r.a.Component);L.defaultProps={children:function(){}};var D=Object(c.b)(null,v)(L),M=(a(164),a(77)),R=(a(353),a(306)),Y=(a(355),a(192)),q=(a(360),a(233)),F=(a(165),a(78)),G=(a(367),a(235)),H=a(38),V=a(188),B=a.n(V),W=function(e){var t=e.login,a=e.password;return r.a.createElement(G.a,{message:"Looking for the credentials, huh?",description:r.a.createElement("div",null,"In order to login use ",r.a.createElement("b",null,t)," as your login and ",r.a.createElement("b",null,a)," as a password."),type:"info",className:B.a.error})},K=function(e){var t=e.initialValues,a=e.validationSchema,n=e.onSubmit,o=e.error;return r.a.createElement(M.a,{className:B.a.container},r.a.createElement(F.a.Title,{level:3},"Log In"),r.a.createElement(H.b,{initialValues:t,validationSchema:a,onSubmit:n},(function(){return r.a.createElement(Y.a,{layout:"vertical"},r.a.createElement(Y.a.Item,{name:"login",label:"Login",required:!0},r.a.createElement(q.a,{name:"login"})),r.a.createElement(Y.a.Item,{name:"password",label:"Password",required:!0},r.a.createElement(q.a.Password,{name:"password",type:"password"})),r.a.createElement(R.a,null,"Log In"),!!o&&r.a.createElement(G.a,{message:o,type:"error",showIcon:!0,className:B.a.error}),r.a.createElement(W,{login:"admin",password:"password"}))})))},J=function(e){return r.a.createElement(D,null,(function(e){return r.a.createElement(K,e)}))},Q=Object(c.b)((function(e){return{user:e.user}}))((function(e){var t=e.user;return r.a.createElement(j.b,{path:"/auth"},t.isAuthorized&&r.a.createElement(j.a,{to:{pathname:"/tweets"}}),!t.isAuthorized&&r.a.createElement(J,null))})),$=function(e){function t(e){var a;return Object(S.a)(this,t),(a=Object(x.a)(this,Object(T.a)(t).call(this,e))).state={page:1,pageSize:10,count:null,sort:null,tweets:[],isLoading:!1},a.sortOptions=[{title:"Publish date",value:"publish_date"},{title:"Title",value:"title"}],a.onPageChange=a.onPageChange.bind(Object(C.a)(a)),a.onPageSizeChange=a.onPageSizeChange.bind(Object(C.a)(a)),a.onSortChange=a.onSortChange.bind(Object(C.a)(a)),a.afterUpdate=a.afterUpdate.bind(Object(C.a)(a)),a}return Object(z.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){this.fetchTweets()}},{key:"afterUpdate",value:function(e){this.setState({page:1},this.fetchTweets)}},{key:"onPageChange",value:function(e){this.setState({page:e},this.fetchTweets)}},{key:"onPageSizeChange",value:function(e){this.setState({pageSize:e,page:1},this.fetchTweets)}},{key:"mapTweetsFromApi",value:function(e){return e.map((function(e){return Object(m.a)({},e,{key:e.id})}))}},{key:"onSortChange",value:function(e){this.setState({page:1,sort:e},this.fetchTweets)}},{key:"fetchTweets",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t,a,n,r,o=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state,a=t.page,n=t.pageSize,r=t.sort,this.setState({isLoading:!0},Object(d.a)(h.a.mark((function e(){var t,i,c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U("tweets/index",{page:a,pageSize:n,sort:r},"get");case 2:t=e.sent,i=t.data,c=i.tweets,s=i.count,o.setState({tweets:o.mapTweetsFromApi(c),count:parseInt(s),isLoading:!1});case 5:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.props.children(Object(m.a)({},this.state,{onPageChange:this.onPageChange,onPageSizeChange:this.onPageSizeChange,onSortChange:this.onSortChange,sortOptions:this.sortOptions,afterUpdate:this.afterUpdate}))}}]),t}(r.a.Component),X=function(e){function t(e){var a;return Object(S.a)(this,t),(a=Object(x.a)(this,Object(T.a)(t).call(this,e))).uploadTweets=a.uploadTweets.bind(Object(C.a)(a)),a.truncateTable=a.truncateTable.bind(Object(C.a)(a)),a}return Object(z.a)(t,e),Object(_.a)(t,[{key:"uploadTweets",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props.afterUpdate,e.prev=1,e.next=4,U("tweets/upload",{tweets:t},"post");case 4:return e.next=6,a();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.warn("Error with uploading tweets");case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"truncateTable",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.afterUpdate,e.next=3,U("tweets/truncate");case 3:return e.next=5,t();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.props.children(Object(m.a)({},this.state,{uploadTweets:this.uploadTweets,truncateTable:this.truncateTable}))}}]),t}(r.a.Component);X.defaultProps={children:function(){},afterUpdate:function(){}};var Z=X,ee=(a(598),a(319)),te=a(307),ae=a.n(te),ne=function(e){var t=e.tweets,a=e.page,n=e.pageSize,o=e.count,i=e.onPageChange,c=e.onPageSizeChange,s=e.isLoading;return r.a.createElement(M.a,{className:ae.a.container},r.a.createElement(F.a.Title,{level:4},"Tweets"),r.a.createElement(ee.a,{dataSource:t,columns:[{title:"ID",dataIndex:"id",key:"id"},{title:"Title",dataIndex:"title",key:"title"},{title:"Description",dataIndex:"description",key:"description"},{title:"Publish Date",dataIndex:"publish_date",key:"publish_date"}],loading:s,pagination:{total:o,current:a,showSizeChanger:!0,pageSizeOptions:["10","20","50"],pageSize:n,onChange:i,onShowSizeChange:function(e,t){return c(t)}}}))},re=(a(268),a(84)),oe=a(311),ie=a.n(oe),ce=function(e){var t=e.isLoading,a=e.sortOptions,n=void 0===a?[]:a,o=e.onSortChange;return r.a.createElement(M.a,{className:ie.a.container},r.a.createElement(F.a.Title,{level:4},"Order"),r.a.createElement(re.a,{loading:t,disabled:t,style:{width:150},placeholder:"Order by...",allowClear:!0,onChange:o},n.map((function(e){return r.a.createElement(re.a.Option,{key:e.value,value:e.value},e.title)}))))},se=(a(599),a(320)),ue=(a(554),a(5)),le=(a(149),a(32)),pe=(a(281),a(144)),he=a(312),de=a.n(he),me=a(141),fe=function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){de.a.parse(t,{worker:!0,complete:e})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=a(189),be=a.n(ge),ve=function(e){var t=e.uploadTweets,a=e.truncateTable,n={name:"file",accept:".csv",multiply:!1,customRequest:function(){var e=Object(d.a)(h.a.mark((function e(a){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.file.data,n=r.map((function(e){var t=Object(E.a)(e,4),a=t[0],n=t[1],r=t[2],o=t[3];return{title:a,description:n,author_name:r,publish_date:me(o,"DD.MM.Y H:mm").format("YYYY-MM-DD HH:mm:00")}})),e.next=3,new Promise((function(e){pe.a.confirm({title:"Upload",content:"".concat(n.length," records were successfully parsed, upload them at the speed of light?"),onOk:function(){var r=Object(d.a)(h.a.mark((function r(){return h.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(n);case 2:e(),a.onSuccess(!0);case 4:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),okText:"Upload",type:"info",onCancel:function(){var t=Object(d.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(),a.onError("You canceled that!");case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()})}));case 3:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}(),transformFile:fe};return r.a.createElement(M.a,{className:be.a.container},r.a.createElement("div",{className:be.a.header},r.a.createElement(F.a.Title,{level:4,className:be.a.title},"Admin Panel"),r.a.createElement(le.a.Group,null,r.a.createElement(le.a,{href:"/sample.csv",target:"_blank",type:"info",icon:"download"},"Get sample"),r.a.createElement(le.a,{type:"danger",icon:"frown",onClick:function(){pe.a.confirm({title:"Truncate table",content:"Are you sure? Somebody (maybe even you) spent a lot of time to fill it up, there could be something important...",okText:"Truncate",okType:"danger",onOk:a})}},"Truncate table"))),r.a.createElement(se.a.Dragger,n,r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(ue.a,{type:"inbox"})),r.a.createElement("p",{className:"ant-upload-text"},"Click or drag .csv file to this area to upload"),r.a.createElement("p",{className:"ant-upload-hint"},"Since you are an authorized user, you can upload table and we will gently parse it")))},we=function(e){var t=e.showAdminPanel;return r.a.createElement($,null,(function(e){return r.a.createElement(r.a.Fragment,null,t&&r.a.createElement(Z,e,(function(e){return r.a.createElement(ve,e)})),r.a.createElement(ce,e),r.a.createElement(ne,e))}))},ye=Object(c.b)((function(e){return{user:e.user}}))((function(e){var t=e.user;return r.a.createElement(j.b,{path:"/tweets"},r.a.createElement(we,{showAdminPanel:t.isAuthorized}))})),Oe=a(1),Ee=function(e){var t=e.user,a=e.children,n=void 0===a?function(){return function(){}}:a,r=e.signOut;return n({isAuthorized:t.isAuthorized,signOut:r})};Ee.propTypes={children:a.n(Oe).a.func};var ke=Object(c.b)((function(e){return{user:e.user}}),v)(Ee),je=(a(595),a(88)),Se=a(316),_e=a(190),xe=a.n(_e),Te=a(317),Ce=a.n(Te),ze=Object(j.f)((function(e){var t=e.signOut,a=e.isAuthorized,o=e.history,i=(Object(Se.a)(e,["signOut","isAuthorized","history"]),Object(n.useState)(null)),c=Object(E.a)(i,2),s=c[0],u=c[1];Object(n.useEffect)((function(){var e;try{var t=o.location.pathname.match(/([^/]+)$/);e=Object(E.a)(t,2)[1]}catch(a){e="tweets"}finally{u(e)}}),[u,o]);return r.a.createElement(O.a.Header,{className:xe.a.container},r.a.createElement(k.b,{to:"/"},r.a.createElement("img",{src:Ce.a,alt:"twitter-logo",className:xe.a.logo})),r.a.createElement(je.a,{theme:"dark",mode:"horizontal",className:xe.a.menu,selectedKeys:[s],onClick:function(e){var a=e.key;switch(a){case"log-in":o.push("/auth/log-in");break;case"log-out":pe.a.confirm({title:"Log out",content:"Are you sure you want to log out? You will be unable to upload new tweets.",okText:"Log out",centered:!0,onOk:t});break;case"tweets":o.push("/tweets");break;default:console.warn("Unknown page: ".concat(a))}u(a)}},r.a.createElement(je.a.Item,{key:"tweets"},"Tweets"),!a&&r.a.createElement(je.a.Item,{key:"log-in"},"Log In"),a&&r.a.createElement(je.a.Item,{key:"log-out"},"Log Out")))})),Ie=a(318),Pe=a.n(Ie),Ae=Object(c.b)((function(e){return{user:e.user}}))((function(e){e.user;var t=Object(n.useState)(!1),a=Object(E.a)(t,2),o=a[0],i=a[1],s=Object(c.c)(),u=localStorage.getItem("token");return Object(n.useEffect)((function(){u&&s({type:"USER/SIGN_IN",payload:u}),i(!0)}),[u,s]),r.a.createElement(k.a,null,r.a.createElement(ke,null,(function(e){return r.a.createElement(ze,e)})),r.a.createElement(O.a,null,r.a.createElement(O.a.Content,{className:Pe.a.layoutContent},o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(j.b,{path:"/",exact:!0},r.a.createElement(j.a,{to:{pathname:"/tweets"}})),r.a.createElement(Q,null),r.a.createElement(ye,null)))))}));var Ne=function(){return r.a.createElement(c.a,{store:y},r.a.createElement(Ae,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[325,1,2]]]);
//# sourceMappingURL=main.90c0df86.chunk.js.map